# ======================================================
# Configuracion general del microservicio
# ======================================================
spring:
  application:
    name: department-head-service   # Cambiar por el nombre del micro

  # ======================================================
  # Subidas multipart (límite del micro)
  # ======================================================
  servlet:
    multipart:
      max-file-size: 60MB        # tamaño máx. por archivo
      max-request-size: 60MB     # tamaño máx. del request completo (incluye metadatos multipart)

  # ======================================================
  #  Configuracion de base de datos (PostgreSQL local/Docker)
  #  Nota:
  #    - Si el micro corre FUERA de docker-compose: DB_HOST=localhost
  #    - Si el micro corre DENTRO del mismo compose: DB_HOST=postgres (nombre del servicio)
  #    - Cada micro debe usar SU propia DB y credenciales (principio DB-per-service)
  # ======================================================
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/department_head_db
    username: ${DB_USER:dept_user}
    password: ${DB_PASS:dept_pass}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: update                  # En dev: update | En prod: validate + Flyway/Liquibase
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  # ======================================================
  # Configuracion de mensajeria (RabbitMQ)
  # ======================================================
  rabbitmq:
    host: localhost
    port: 5672
    username: appuser
    password: apppass
    publisher-confirm-type: correlated
    publisher-returns: true
    template:
      mandatory: true
    listener:
      simple:
        acknowledge-mode: auto
        concurrency: 2
        max-concurrency: 8
        prefetch: 20
        default-requeue-rejected: false

# ======================================================
# Topologia de mensajeria (nombres reutilizables)
# ======================================================
messaging:
  exchange:
    main: degree.events
    dlx: degree.dlx
  queues:
    auth: auth-service.q
    project: academic-project-service.q
    coordinator: coordinator-service.q
    department: department-head-service.q
    notification: notification-service.q
    authDlq: auth-service.dlq
    projectDlq: academic-project-service.dlq
    coordinatorDlq: coordinator-service.dlq
    departmentDlq: department-head-service.dlq
    notificationDlq: notification-service.dlq
  routing:
    userCreated: auth.user.created
    projectCreated: project.created
    projectUpdated: project.updated
    formatAApprovedByCoordinator: coordinator.formata.approved
    proposalApprovedByDeptHead: department.proposal.approved
    notificationAny: notification.send.*

# ======================================================
# Configuracion del servidor embebido (Tomcat)
# ======================================================
server:
  port: 8084

# ======================================================
# Actuator
# ======================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info   # /actuator/health vía gateway: /api/department/actuator/health

# ======================================================
# Configuracion de Swagger / OpenAPI
# ======================================================
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha

# ======================================================
# Logs y formato basico
# ======================================================
logging:
  level:
    root: INFO
    org.springframework.web: INFO
    org.hibernate.SQL: DEBUG
  file:
    name: logs/${spring.application.name}.log
